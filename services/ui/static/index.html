<!doctype html><html><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Whispering Machine</title>
<style>
body{font-family:system-ui,sans-serif;margin:0;background:#0b0c10;color:#e5e7eb}
header{padding:12px 16px;background:#111827;position:sticky;top:0}
main{padding:16px;display:grid;gap:12px}
.card{background:#111827;border:1px solid #1f2937;border-radius:10px;padding:12px 16px}
.meter{height:16px;background:#1f2937;border-radius:8px;overflow:hidden}
.bar{height:100%;width:0%;background:#22d3ee;transition:width .2s linear}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.tiny{color:#9ca3af;font-size:12px}
</style></head><body>
<header><strong>Whispering Machine â€” Party Dashboard</strong>
<span class="tiny" id="fabrication"></span></header>
<main>
<section class="card"><div>Loudness</div>
<div class="meter"><div id="bar" class="bar"></div></div>
<div class="tiny" id="rmsLabel">rms: 0</div></section>
<section class="card"><div>Occupancy</div><div id="rooms" class="grid"></div></section>
<section class="card"><div>Button Tallies</div><div id="buttons"></div></section>
</main>
<script>
const ws=new WebSocket((location.protocol==='https:'?'wss://':'ws://')+location.host+'/ws');
const bar=document.getElementById('bar'),rmsLabel=document.getElementById('rmsLabel'),
rooms=document.getElementById('rooms'),buttons=document.getElementById('buttons'),
fabrication=document.getElementById('fabrication');
ws.onmessage=(ev)=>{const s=JSON.parse(ev.data);const rms=Math.max(0,Math.min(100,Math.round(s.noise?.rms??0)));
bar.style.width=rms+'%';rmsLabel.textContent='rms: '+rms;
fabrication.textContent='fabrication '+Math.round((s.fabrication?.level??0)*100)+'%';
rooms.innerHTML='';Object.entries(s.rooms||{}).forEach(([name,occ])=>{const d=document.createElement('div');d.className='card';d.textContent=`${name}: ${occ?'occupied':'empty'}`;rooms.appendChild(d);});
buttons.innerHTML='';Object.entries(s.buttons||{}).forEach(([k,v])=>{const d=document.createElement('div');d.textContent=`${k}: ${v}`;buttons.appendChild(d);});};
</script></body></html>
